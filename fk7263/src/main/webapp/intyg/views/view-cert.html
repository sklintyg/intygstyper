<div class="row-fluid">

  <div id="backnav" class="row-fluid">
    <a class="backlink" href="/web/start"> <span message key="button.goback"></span>
    </a>
  </div>
  
  <div mi-spinner label="view.message.certificateloading" show-spinner="!doneLoading" show-content="doneLoading">


    <!-- Content -->
    <div class="row-fluid">
      <div class="span7">
        <h1 ng-focus="pagefocus" tabindex="-1">
          <span message key="view.label.pagetitle"></span>
        </h1>
        <p>
          <span message key="view.label.pagedescription"></span>
        </p>
        <form id="view-as-pdf" action="/moduleapi/certificate/{{cert.id.extension}}/pdf" method="get" target="_blank">
          <p class="btn-row">
            <button id="sendCertificateBtn" type="button" ng-click="send()" class="btn btn-success">
              <span message key="view.button.sendToFK"></span>
            </button>
            <button id="downloadprint" type="submit" class="btn btn-inverse">
              <span message key="button.downloadprint"></span>
            </button>
          </p>
        </form>
      </div>
      <div class="span5 eventbox">
        <h2>
          <span message key="view.label.latestevent"></span>
        </h2>
        <!--  Show if no events to show -->
        <p ng-show="cert.filteredStatuses.length<1">
          <span message key="view.label.latestevent.noevents"></span></a>
        </p>

        <!-- Show first status in list if any viable status exist-->
        <p id="lastest-certificate-event" ng-show="cert.filteredStatuses.length>0">
          {{cert.filteredStatuses[0].timestamp | date:'shortDate'}} <span message key="fk7263.status.{{cert.filteredStatuses[0].type}}"></span> <span message
            key="fk7263.target.{{cert.filteredStatuses[0].target}}"></span>
        </p>
        <!-- Show if more than 1 viable status exists -->
        <p ng-show="cert.filteredStatuses.length>1">
          <a class="statusHistoryLink" href ng-click="showStatusHistory()"><span message key="view.label.latestevent.showall"></span></a>
        </p>
      </div>
    </div>
    <div id="certificate" class="certificate">
      <span class="hide" id="certId" title="{{cert.id.extension}}"></span> <span class="hide" id="certType" title="{{cert.typ.code}}"></span>

      <div class="row-fluid">
        <div class="span12">
          <div class="cert">
            <div class="cert-titlebar">
              <img class="cert-icon" alt="" ng-src="{{cert.typ_image}}" />

              <div class="row-fluid">
                <div class="span6">
                  <h2 class="cert-title">
                    <span message key="certificatetypes.{{cert.typ.code}}.commonname"></span> <span class="cert-titlebar-type"><span message key="certificatetypes.{{cert.typ.code}}.typename"></span></span>
                  </h2>
                </div>
                <div class="span6 issue">
                  <span><span message key="view.label.issued"></span></span> <span class="cert-titlebar-value">{{cert.signeringsDatum | date:'longDate'}}</span>
                </div>
              </div>
            </div>

            <div class="cert-header">
              <div class="row-fluid">
                <div class="span6 header-row">
                  <h3 class="tag">
                    <span message key="view.label.patientname"></span>
                  </h3>
                  <span id="patient-name">{{cert.patient.fullstandigtNamn}}</span>
                </div>
                <div class="span6">
                  <h3 class="tag">
                    <span message key="view.label.nedsattning"></span>
                  </h3>

                  <div ng-show="cert.nedsattning25percent != null">
                    <span message key="nedsattningsgrad.nedsatt_med_1_4"></span> ({{cert.nedsattning25percent.observationsPeriod.from |
                    date:'longDate'}}&ndash;{{cert.nedsattning25percent.observationsPeriod.tom | date:'longDate'}})
                  </div>

                  <div ng-show="cert.nedsattning50percent != null">
                    <span message key="nedsattningsgrad.nedsatt_med_1_2"></span> ({{cert.nedsattning50percent.observationsPeriod.from |
                    date:'longDate'}}&ndash;{{cert.nedsattning50percent.observationsPeriod.tom | date:'longDate'}})
                  </div>

                  <div ng-show="cert.nedsattning75percent != null">
                    <span message key="nedsattningsgrad.nedsatt_med_3_4"></span> ({{cert.nedsattning75percent.observationsPeriod.from |
                    date:'longDate'}}&ndash;{{cert.nedsattning75percent.observationsPeriod.tom | date:'longDate'}})
                  </div>

                  <div ng-show="cert.nedsattning100percent != null">
                    <span message key="nedsattningsgrad.helt_nedsatt"></span> ({{cert.nedsattning100percent.observationsPeriod.from |
                    date:'longDate'}}&ndash;{{cert.nedsattning100percent.observationsPeriod.tom | date:'longDate'}})
                  </div>


                </div>
              </div>

              <div class="row-fluid">
                <div class="span6 header-row">
                  <h3 class="tag">
                    <span message key="view.label.civicnumber"></span>
                  </h3>
                  <span id="patient-crn">{{cert.patient.id.extension}}</span>
                </div>
                <div class="span6"></div>
              </div>
              <div class="row-fluid">
                <div class="span6 header-row">
                  <h3 class="tag">
                    <span message key="view.label.unit"></span>
                  </h3>
                  <span id="careunit">{{cert.skapadAv.vardenhet.namn}}</span>
                </div>
                <div class="span6">
                  <h3 class="tag">
                    <span message key="view.label.issuer"></span>
                  </h3>
                  <span id="caregiver">{{cert.skapadAv.vardenhet.vardgivare.namn}}</span>
                </div>
              </div>
            </div>
            <div class="table-bottom"></div>

            <div class="cert-body">

              <div mi-field field-label="view.label.smittskydd" filled="cert.filledAlways">
                <span ng-show="cert.avstangningEnligtSmittskyddslagen != null"> <span message key="view.label.yes"></span></span> <span ng-show="cert.avstangningEnligtSmittskyddslagen == null">
                  <span message key="view.label.no"></span>
              </div>


              <div mi-field field-label="view.label.diagnosis" filled="cert.filledDiagnosis">
                {{cert.medicinsktTillstand.beskrivning}} (<span class="tag"><span message key="view.label.diagnosisCode"></span></span> {{cert.medicinsktTillstand.observationsKod.code}})
              </div>

              <div mi-field field-label="view.label.progressofdesease" filled="cert.filledProgress">{{cert.bedomtTillstand.beskrivning}}</div>

              <div mi-field field-label="view.label.disabilities" filled="cert.filledDisabilities">{{cert.funktionsnedsattning.beskrivning}}</div>

              <div mi-field field-label="view.label.basedon" filled="cert.filledBasedOn">
                <ul>
                  <li ng-repeat="vardkontakt in cert.vardkontakter"><span message key="vardkontakt.{{vardkontakt.vardkontakttyp.code}}" param="vardkontakt.vardkontaktstid.start | date:'longDate'"></span></li>
                  <li ng-repeat="referens in cert.referenser"><span message key="referens.{{referens.referenstyp.code}}" param="referens.datum| date:'longDate'"></span>
                    <div ng-show="referens.referenstyp.code == '74964007'">
                      <!-- Annat -->
                      <span class="tag"><span message key="view.label.comment"></span></span> <span ng-repeat="kommentar in cert.kommentars">{{kommentar}}</span>
                    </div></li>
                </ul>
              </div>

              <div mi-field field-label="view.label.limitation" filled="cert.filledLimitation">{{cert.aktivitetsbegransning.beskrivning}}</div>

              <div mi-field field-label="view.label.recommendations" filled="cert.filledRecommendations">
                <ul>
                  <li ng-show="cert.rekommenderarKontaktMedArbetsformedlingen != null"><span message key="view.label.recommendations.contact.jobcenter"></span></li>
                  <li ng-show="cert.rekommenderarKontaktMedForetagshalsovarden != null"><span message key="view.label.recommendations.contact.healthdepartment"></span></li>
                  <li ng-show="cert.rekommenderarOvrigt != null">{{cert.rekommenderarOvrigt.beskrivning}}</li>
                </ul>
              </div>

              <div mi-field field-label="view.label.plannedtreatment" filled="cert.filledPlannedTreatment">
                <ul>
                  <li ng-show="cert.atgardInomSjukvarden != null"><span message key="view.label.plannedtreatment.healthcare"></span> {{cert.atgardInomSjukvarden.beskrivning}}</li>
                  <li ng-show="cert.annanAtgard != null"><span message key="view.label.plannedtreatment.other"></span> {{cert.annanAtgard.beskrivning}}</li>
                </ul>
              </div>

              <div mi-field field-label="view.label.workrehab" filled="cert.filledWorkRehab">
                <span ng-show="cert.arbetsinriktadRehabiliteringAktuell != null"> <span message key="view.label.yes"></span></span> <span ng-show="cert.arbetsinriktadRehabiliteringEjAktuell != null">
                  <span message key="view.label.no"></span>
                </span> <span ng-show="cert.arbetsinriktadRehabiliteringEjBedombar != null"> <span message key="view.label.unjudgeable"></span></span>
              </div>

              <div mi-field field-label="view.label.patientworkcapacity" filled="cert.filledPatientWorkCapacity">
                <ul>
                  <li ng-show="cert.arbetsformagaIForhallandeTillNuvarandeArbete"><span message key="view.label.patientworkcapacity.currentwork"></span> <span
                    ng-repeat="uppgift in cert.patient.arbetsuppgifts"> {{uppgift.typAvArbetsuppgift}} </span></li>
                  <li ng-show="cert.arbetsformagaIForhallandeTillArbetsloshet"><span message key="view.label.patientworkcapacity.unemployed"></span></li>
                  <li ng-show="cert.arbetsformagaIForhallandeTillForaldraledighet"><span message key="view.label.patientworkcapacity.parentalleave"></span></li>
                </ul>
              </div>

              <div mi-field field-label="view.label.patientworkcapacityjudgement" filled="cert.filledPatientWorkCapacityJudgement">{{cert.arbetsformagaAktivitetsbegransning.prognos.beskrivning}}</div>

              <div mi-field field-label="view.label.prognosis" filled="cert.filledPrognosis">
                <ul>
                  <li ng-show="cert.prognosFullAterstallning"><span message key="view.label.yes"></span></li>
                  <li ng-show="cert.prognosDelvisAterstallning"><span message key="view.label.partialyes"></span></li>
                  <li ng-show="cert.prognosEjAterstallning"><span message key="view.label.no"></span></li>
                  <li ng-show="cert.prognosAterstallningGarEjBedomma"><span message key="view.label.unjudgeable"></span><br> <span class="tag"><span message key="view.label.comment"></span></span>
                    <span ng-repeat="kommentar in cert.kommentars">{{kommentar}}</span></li>
                </ul>
              </div>

              <div mi-field field-label="view.label.othertransport" filled="cert.filledPatientOtherTransport">
                <span ng-show="cert.forandratRessattAktuellt != null"> <span message key="view.label.yes"></span></span> <span ng-show="cert.forandratRessattEjAktuellt != null"> <span message
                  key="view.label.no"></span></span>
              </div>

              <div mi-field field-label="view.label.fkcontact" filled="cert.filledFKContact">
                <span ng-show="cert.kontaktMedForsakringskassanAktuell != null"> <span message key="view.label.yes"></span></span> <span ng-show="cert.kontaktMedForsakringskassanAktuell == null">
                  <span message key="view.label.no"></span>
                </span>
              </div>

              <div class="body-row">
                <h3 class="title">
                  <span message key="view.label.workcodes"></span>
                </h3>
                <span class="text" ng-show="cert.forskrivarkodOchArbetsplatskod != null">{{cert.forskrivarkodOchArbetsplatskod}}</span>
              </div>

              <div class="row-fluid">
                <div class="span7">
                  <div class="infobox">
                    <h3>
                      <span message key="view.label.confirmedby"></span>
                    </h3>
                    <h4>
                      <span message key="view.label.date"></span>
                    </h4>
                    <p>{{cert.signeringsDatum | date:'longDate'}}</p>
                    <h4>
                      <span message key="view.label.contactinfo"></span>
                    </h4>
                    <p>
                      <span class="text">{{cert.skapadAv.namn}}</span><br> <span class="text">{{cert.skapadAv.vardenhet.namn}}</span><br> <span class="text">{{cert.skapadAv.vardenhet.postadress}}</span><br>
                      <span class="text">{{cert.skapadAv.vardenhet.postnummer}} {{cert.skapadAv.vardenhet.postort}}</span><br> <span class="text">{{cert.skapadAv.vardenhet.telefonnummer}}</span><br>
                    </p>
                  </div>
                </div>
              </div>

            </div>
            <!-- cert-body -->

          </div>
        </div>
      </div>
    </div>

  </div>
  <!-- eof spinner -->
</div>
