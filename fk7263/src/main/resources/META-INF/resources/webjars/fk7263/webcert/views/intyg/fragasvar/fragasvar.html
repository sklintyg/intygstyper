<div class="row weak-hidden" ng-class="{show: widgetState.showTemplate}">
  <div class="col-md-12 qa-column">

    <div wc-spinner label="fk7263.info.loading.existing.qa" show-spinner="!widgetState.doneLoading"
         show-content="widgetState.doneLoading">

      <div class="webcert-bottom-padding-section" ng-show="certProperties.isLoaded">

        <h2 class="col-head" ng-show="certProperties.kompletteringOnly">Kompletteringar<span wc-help-mark field-help-text="qa.help.kompletteringar"></span></h2>

        <!-- Question button -->
        <div
            ng-show="!certProperties.kompletteringOnly && !certProperties.isRevoked && !widgetState.newQuestionOpen && (viewState.isIntygOnSendQueue || certProperties.isSent || qaList.length>0)"
            wc-check-vardenhet vardenhet="{{cert.grundData.skapadAv.vardenhet.enhetsid}}">
          <div class="form-group">
            <button type="button" class="btn btn-success" ng-click="toggleQuestionForm()" id="askQuestionBtn">Ny fråga till
              Försäkringskassan
            </button>
          </div>
        </div>
        <div ng-if="viewState.isIntygOnSendQueue === false && certProperties.isSent === false && (qaList.length<1)" wc-check-vardenhet
             vardenhet="{{cert.grundData.skapadAv.vardenhet.enhetsid}}" class="alert alert-info"
             id="certificate-is-not-sent-to-fk-message-text">
          <strong>Intyget är inte skickat till Försäkringskassan.</strong><br> Det går därför inte att ställa frågor om
          intyget.
        </div>
        <div ng-if="certProperties.isSent === undefined && (qaList.length<1)" wc-check-vardenhet
             vardenhet="{{cert.grundData.skapadAv.vardenhet.enhetsid}}" class="alert alert-info"
             id="certificate-is-not-available">
          <strong>Det finns inga frågor och svar.</strong>
        </div>

        <!-- New question form -->
        <div ng-show="widgetState.newQuestionOpen">
          <div class="form-group">
            <div class="alert alert-info">
              Här kan du föra en dialog med Försäkringskassan om ett intyg. Medicinsk information ska endast skickas via signerade intyg.
            </div>
          </div>
          <div class="form-group">
            <label class="control-label">Fråga</label>
            <textarea wc-maxlength ng-trim="false" maxlength="2000" rows="13" class="form-control" ng-change="onFrageTextChange()"
                      ng-model="newQuestion.frageText" wc-focus-me="widgetState.focusQuestion"
                      id="newQuestionText"></textarea>
          </div>
          <div class="form-group" id="newQuestionForm">
            <label class="control-label">Ämne</label>
            <div class="controls">
              <select id="new-question-topic" class="form-control" ng-model="newQuestion.chosenTopic"
                      ng-options="c.label for c in newQuestion.topics track by c.value"></select>
            </div>
          </div>

          <!-- error message occuring when inteacting with server for this FragaSvar-->
          <div id="newQuestion-load-error" ng-show="newQuestion.activeErrorMessageKey" class="alert alert-danger">
            <span message key="fk7263.error.{{newQuestion.activeErrorMessageKey}}"></span>
          </div>

          <!-- Form button group -->
          <div class="form-group">
            <button type="button" class="btn btn-success" ng-click="sendQuestion(newQuestion)"
                    ng-disabled="!questionValidForSubmit(newQuestion)" title="{{newQuestion.sendButtonToolTip}}"
                    id="sendQuestionBtn">
              <img src="/img/loader-small-green.gif" ng-show="newQuestion.updateInProgress"> Skicka till
              Försäkringskassan
            </button>
            <button type="button" class="btn btn-default btn-secondary" ng-click="toggleQuestionForm()" id="cancelQuestionBtn">Avbryt
              fråga
            </button>
          </div>
        </div>
        <!--  Fragasvar formular end -->

        <!-- question sent message -->
        <div ng-if="widgetState.sentMessage">
          <div alert type="info" close="dismissSentMessage()" id="question-is-sent-to-fk-message-text">
            <strong>Frågan är skickad till Försäkringskassan</strong><br><span wc-authority="HANTERA_MAILSVAR"> Vårdenheten kontaktas via mejl när svar har inkommit.</span>
          </div>
        </div>

        <!-- error message -->
        <div id="qa-list-load-error" ng-show="widgetState.doneLoading && widgetState.activeErrorMessageKey"
             class="alert alert-danger">
          <span message key="fk7263.error.{{widgetState.activeErrorMessageKey}}"></span>
        </div>
      </div>

      <div class="webcert-col-section table-padding-top qa-list-section" ng-show="qaList.length > 0" id="unhandledQACol">

          <div ng-show="widgetState.showAllKompletteringarHandled" id="unhandledQAColNoEntries">
              Alla kompletteringar är hanterade.
          </div>

        <div ng-repeat="qa in qaList | filter:openIssuesFilter | orderBy:'senasteHandelseDatum':true" class="qa-item">
          <div qa-panel panel-id="unhandled" qa="qa" qa-list="qaList" cert="cert" cert-properties="certProperties"></div>
        </div>

        <div ng-show="!certProperties.kompletteringOnly">
          <h2 class="col-head" ng-show="qaListFiltered.length > 0">Tidigare frågor och svar <span wc-help-mark field-help-text="qa.help.handled"></span></h2>
          <div ng-repeat="qa in qaListFiltered = (qaList | filter:closedIssuesFilter | orderBy:'senasteHandelseDatum':true)" class="qa-item">
            <div qa-panel panel-id="handled" qa="qa" qa-list="qaList" cert="cert" cert-properties="certProperties"></div>
          </div>
        </div>

      </div>

    </div>

  </div>
  <!--  end spinner -->

</div>
