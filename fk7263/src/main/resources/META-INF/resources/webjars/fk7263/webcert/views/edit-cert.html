<a id="top"></a>
<div class="container-fluid" id="edit-fk7263">
  <div class="row">
    <div class="col-md-12 webcert-col webcert-col-single">

      <div wc-print-header title-id="fk7263.label.certtitle" print-message-id="print.label.draft"
           intygs-id="cert.id"></div>

      <div class="header-fix-top print-hide">
        <div class="header-wrapper" ng-hide="widgetState.collapsedHeader" ng-animate="'menucollapse'">
          <div id="wcHeader" wc-header default-active="index"></div>
        </div>

        <div ng-hide="widgetState.activeErrorMessageKey">
          <div wc-spinner label="info.loadingdata" show-spinner="!widgetState.doneLoading"
               show-content="widgetState.doneLoading">

            <div class="header-fix-panel">
              <div class="header-fix-top-expand">
                <div class="header-fix-top-expand-wrapper">
                  <button class="btn btn-link" ng-click="toggleHeader()"><span
                      ng-if="widgetState.collapsedHeader">Visa</span><span
                      ng-if="!widgetState.collapsedHeader">Dölj</span> meny
                  </button>
                </div>
              </div>
              <a id="tillbakaButton" wc-feature-not-active feature="franJournalsystem" class="backlink-icon"
                 href wc-back title="Tillbaka till Skriv intyg"></a>
              <h1 style="display: inline-block; margin-right: 20px;"><span message key="fk7263.label.certtitle"></span>
              </h1>
              <div class="inline-block">
                <label class="control-label" id="patientNamnPersonnummer">{{cert.grundData.patient.fullstandigtNamn}} -
                  {{cert.grundData.patient.personId}}</label>
              </div>

              <div wc-new-person-id-message></div>

              <div class="form-group buttonbar">
                <button id="spara-utkast" class="btn btn-info" ng-click="save()" ng-if="!isSigned"
                        ng-disabled="!certForm.$dirty" title="Sparar intyget som ett utkast.">Spara
                </button>
                <button id="ta-bort-utkast" class="btn btn-default btn-secondary" ng-if="!isSigned" ng-click="discard()"
                        title="Klicka på papperskorgen för att radera utkastet."><i
                    class="glyphicon glyphicon-trash"></i>
                </button>
                <button id="skriv-ut-utkast" class="btn btn-default btn-secondary" ng-if="!isSigned" ng-click="print()"
                        title="Skriver ut utkastet.">
                  Skriv ut
                </button>
                <button class="btn btn-default btn-secondary" ng-if="!widgetState.showComplete" ng-disabled="isComplete"
                        ng-click="toggleShowComplete()" id="showCompleteButton"
                        title="Visar vilka obligatoriska fält i utkastet som inte är ifyllda. Alla obligatoriska fält måste vara ifyllda för att utkastet ska kunna signeras.">
                  Visa vad som saknas
                </button>
                <button class="btn btn-default btn-secondary" ng-if="widgetState.showComplete" ng-disabled="isComplete"
                        ng-click="toggleShowComplete()" id="hideCompleteButton"
                        title="Visar vilka obligatoriska fält i utkastet som inte är ifyllda. Alla obligatoriska fält måste vara ifyllda för att utkastet ska kunna signeras.">
                  Dölj vad som saknas
                </button>
              </div>

              <!-- Show save errors here to spare user from retyping everything for intermittent errors -->
              <div class="row">
                <div ng-show="widgetState.saveErrorMessageKey != null" class="col-md-7">
                  <div class="alert alert-danger">
                    <span message key="{{widgetState.saveErrorMessageKey}}"></span>
                  </div>
                </div>
              </div>

              <!-- Just in case -->
              <div id="certificate-is-sent-to-it-message-text" ng-show="isSigned"><span message
                                                                                        key="draft.status.signed"></span>
              </div>
              <!-- complete -->
              <div ng-show="certForm.$pristine && isComplete && !isSigned"><span id="intyget-sparat-meddelande" message
                                                                                 key="draft.status.draft_complete"></span>
              </div>
              <!-- incomplete -->
              <div ng-show="certForm.$pristine && !isComplete"><span id="intyget-ej-komplett-meddelande" message
                                                                     key="draft.status.draft_incomplete"></span>
              </div>
              <!-- form changed -->
              <div ng-show="certForm.$dirty"><span message key="draft.status.changed"></span></div>
            </div>
          </div>
        </div>
      </div>
      <!-- top end -->

      <!-- Total fail error messages -->
      <div id="error-panel" class="cert-error-panel"
           ng-show="widgetState.doneLoading && widgetState.activeErrorMessageKey && !widgetState.deleted">
        <div class="alert alert-danger">
          <span message key="{{widgetState.activeErrorMessageKey}}"></span>
        </div>
      </div>

      <!-- Integration deleted message -->
      <div id="integration-deleted" ng-if="widgetState.deleted">
        <div class="alert alert-info banner-margin">
          Utkastet är raderat och borttaget från Webcert.
        </div>
      </div>

      <!-- FK 7263 -->
      <div class="edit-form" ng-class="{'collapsed' : widgetState.collapsedHeader}">

        <form name="certForm" novalidate autocomplete="off" wc-auto-save="save(true)">
          <div ng-hide="widgetState.activeErrorMessageKey || widgetState.deleted">

            <div wc-spinner label="info.loadingdata" show-spinner="!widgetState.doneLoading"
                 show-content="widgetState.doneLoading">

              <div class="alert alert-danger" ng-show="widgetState.showComplete && !isComplete"
                   style="margin-right: 20px">
                <h3><span message key="draft.saknar-uppgifter"></span></h3>
                <ul>
                  <li ng-repeat="message in validationMessages">
                    <span message key="{{message.message}}"></span></li>
                </ul>
              </div>

              <div id="certificate" class="row certificate">
                <div class="col-md-12 cert-body">

                  <!-- 1. Smittskydd -->
                  <div wc-field-single field-number="1" field-help-text="fk7263.helptext.smittskydd">
                    <label for="smittskydd" class="control-label title-single">
                      <input id="smittskydd" name="smittskydd" type="checkbox" ng-model="cert.avstangningSmittskydd"
                             ng-change="onChangeSmittskydd()" wc-focus-on="firstInput">&nbsp;<span message
                                                                                                   key="fk7263.label.smittskydd"></span>
                    </label>
                  </div>

                  <!-- 4b. Intyger baseras på -->
                  <div id="intygetbaseraspa" wc-field field-label="fk7263.label.intyg-baserat-pa" field-number="4b"
                       field-help-text="fk7263.helptext.intyg-baserat-pa" ng-hide="cert.avstangningSmittskydd"
                       ng-animate="'fade'">
                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.intygbaseratpa" id="validationMessages_intygbaseratpa">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.intygbaseratpa"><span message
                                                                                                  key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>

                    <!-- Undersökning -->
                    <div class="form-group form-inline">
                      <label class="checkbox inline-block" style="min-width: 250px"><input type="checkbox"
                                                                                           id="basedOnExamination"
                                                                                           name="informationBasedOn.examination"
                                                                                           class="checkbox-inline"
                                                                                           ng-model="basedOnState.check.undersokningAvPatienten"
                                                                                           ng-change="toggleBaseradPaDate('undersokningAvPatienten')">
                        Min undersökning av patienten</label>
                      <span wc-date-picker-field target-model="cert.undersokningAvPatienten"
                            dom-id="undersokningAvPatientenDate"></span>
                    </div>

                    <!-- Telefonkontakt -->
                    <div class="form-group form-inline">
                      <label class="checkbox inline-block" style="min-width: 250px"><input type="checkbox"
                                                                                           id="basedOnPhoneContact"
                                                                                           name="informationBasedOn.phoneContact"
                                                                                           ng-model="basedOnState.check.telefonkontaktMedPatienten"
                                                                                           ng-change="toggleBaseradPaDate('telefonkontaktMedPatienten')">
                        Min telefonkontakt med patienten</label>
                      <span wc-date-picker-field target-model="cert.telefonkontaktMedPatienten"
                            dom-id="telefonkontaktMedPatientenDate"></span>
                    </div>

                    <!-- Journaluppgifter -->
                    <div class="form-group form-inline">
                      <label class="checkbox inline-block" style="min-width: 250px"><input type="checkbox"
                                                                                           id="basedOnJournal"
                                                                                           name="informationBasedOn.journal"
                                                                                           ng-model="basedOnState.check.journaluppgifter"
                                                                                           ng-change="toggleBaseradPaDate('journaluppgifter')">
                        Journaluppgifter</label>
                      <span wc-date-picker-field target-model="cert.journaluppgifter"
                            dom-id="journaluppgifterDate"></span>
                    </div>

                    <!-- Annat -->
                    <div class="form-group form-inline">
                      <label class="checkbox inline-block" style="min-width: 250px"><input type="checkbox"
                                                                                           id="basedOnOther"
                                                                                           name="informationBasedOn.other"
                                                                                           ng-model="basedOnState.check.annanReferens"
                                                                                           ng-change="toggleBaseradPaDate('annanReferens')">
                        Annat<span wc-enable-tooltip field-help-text="fk7263.helptext.intyg-baserat-pa.annat"></span>
                      </label>
                      <span wc-date-picker-field target-model="cert.annanReferens" dom-id="annanReferensDate"></span>
                    </div>
                    <div class="otherText indent" ng-if="basedOnState.check.annanReferens">
                      <span>Ange vad:</span><br>
                      <textarea id="informationBasedOnOtherText" name="informationBasedOn.otherText" rows='2'
                                class='form-control otherInformation' ng-model="form.ovrigt.annanReferensBeskrivning"
                                ng-change="limitOtherField('annanReferensBeskrivning')"></textarea>
                      <div class="counter">
                        Tecken kvar: {{inputLimits.ovrigt - getTotalOvrigtLength()}}
                      </div>
                      <div class="info-transfer">Informationen överförs till "Övriga upplysningar" vid PDF-utskrift av
                        blanketten.
                      </div>
                    </div>
                  </div>

                  <div wc-field field-label="fk7263.label.diagnos" field-number="2"
                       field-help-text="fk7263.helptext.diagnos" ng-hide="cert.avstangningSmittskydd"
                       ng-animate="'fade'" class="print-pagebreak-after" id="diagnoseForm">
                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.diagnos" id="validationMessages_diagnos">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.diagnos"><span message
                                                                                           key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>
                    <div class="row bottom-padding-small">
                      <div class='col-xs-12'>
                        <div class='divider'>
                          <span message key="fk7263.label.valjkodverk"></span>
                          <label class="radio-inline">
                            <input type="radio" id="diagnoseKodverk_ICD_10_SE" name="diagnosKodverk" value="ICD_10_SE"
                                   ng-model="form.diagnosKodverk" checked="checked" ng-change="onChangeKodverk()"><span message key="fk7263.label.diagnoskodverk.icd_10_se"></span>
                          </label>
                          <label class="radio-inline">
                            <input type="radio" id="diagnoseKodverk_KSH_97_P" name="diagnosKodverk" value="KSH_97_P"
                                   ng-model="form.diagnosKodverk" ng-change="onChangeKodverk()"><span message key="fk7263.label.diagnoskodverk.ksh_97_p"></span>
                          </label>
                        </div>
                      </div>
                    </div>
                    <div class="row bottom-padding-small">
                      <div class='col-xs-3'>
                        <label class="control-label unbreakable">ICD-10</label>
                        <input type="text" class="form-control" id="diagnoseCode" name="diagnose.code" value=""
                               class='diagnose-code col-xs-11 form-control' ng-model="cert.diagnosKod"
                               typeahead="d.value as d.label for d in getDiagnoseCodes(form.diagnosKodverk, $viewValue) | filter:$viewValue | limitTo:10"
                               typeahead-min-length="3" typeahead-on-select="onDiagnoseCode1Select($item)"
                               typeahead-template-url="/web/webjars/fk7263/webcert/views/diagnoseTemplate.html"
                               wc-to-uppercase
                            >
                      </div>
                      <div class='col-xs-9'>
                        <label class="control-label">Diagnos</label>
                        <input type="text" class="form-control maxwidth" id="diagnoseDescription"
                               class="col-xs-12 form-control" name="diagnose.description" value=""
                               ng-model="cert.diagnosBeskrivning1"
                               typeahead="d.value as d.label for d in searchDiagnoseByDescription(form.diagnosKodverk, $viewValue) | filter:$viewValue "
                               typeahead-on-select="onDiagnoseDescription1Select($item)"
                               typeahead-template-url="/web/webjars/fk7263/webcert/views/diagnoseTemplate.html"
                               typeahead-wait-ms="100" ng-change="limitDiagnosBeskrivningField('diagnosBeskrivning1')">
                        <span class="counter">Tecken kvar: {{inputLimits.diagnosBeskrivning - getTotalDiagnosBeskrivningLength()}}</span>
                      </div>
                    </div>
                    <div class="row bottom-padding-tiny">
                      <div class='col-xs-3'>
                        <label class="control-label unbreakable">ICD-10</label>
                        <div class="controls">
                          <div class="bottom-padding-small clearfix">
                            <input type="text" id="diagnoseCodeOpt1" name="diagnose.codeOpt1" value=""
                                   ng-model="cert.diagnosKod2" class="col-xs-11 form-control"
                                   typeahead="d.value as d.label for d in getDiagnoseCodes(form.diagnosKodverk, $viewValue) | filter:$viewValue | limitTo:10"
                                   typeahead-min-length="3" typeahead-on-select="onDiagnoseCode2Select($item)"
                                   typeahead-template-url="/web/webjars/fk7263/webcert/views/diagnoseTemplate.html"
                                   ng-change="limitDiagnosBeskrivningField('diagnosKod2')"
                                   wc-to-uppercase>
                          </div>
                        </div>
                      </div>
                      <div class='col-xs-9'>
                        <label class="control-label inline-block"><span message
                                                                        key="fk7263.label.ytterligarediagnoser"></span>
                          (frivilligt)</label><span wc-enable-tooltip class="absolute"
                                                    field-help-text="fk7263.helptext.diagnos.ytterligare"></span>
                        <div class="bottom-padding-small clearfix">
                          <input type="text" id="diagnoseDescriptionOpt1" name="diagnose.descriptionOpt1" value=""
                                 ng-model="cert.diagnosBeskrivning2" class="block col-xs-12 form-control maxwidth"
                                 typeahead="d.value as d.label for d in searchDiagnoseByDescription(form.diagnosKodverk, $viewValue) | filter:$viewValue "
                                 typeahead-on-select="onDiagnoseDescription2Select($item)"
                                 typeahead-template-url="/web/webjars/fk7263/webcert/views/diagnoseTemplate.html"
                                 typeahead-wait-ms="100" ng-change="limitDiagnosBeskrivningField('diagnosBeskrivning2')">
                          <span class="counter">Tecken kvar: {{inputLimits.diagnosBeskrivning - getTotalDiagnosBeskrivningLength()}}</span>
                        </div>
                      </div>
                    </div>
                    <div class="row bottom-padding-small">
                      <div class='col-xs-3'>
                        <input type="text" id="diagnoseCodeOpt2" name="diagnose.codeOpt2" value=""
                               ng-model="cert.diagnosKod3" class="col-xs-11 form-control"
                               typeahead="d.value as d.label for d in getDiagnoseCodes(form.diagnosKodverk, $viewValue) | filter:$viewValue | limitTo:10"
                               typeahead-min-length="3" typeahead-on-select="onDiagnoseCode3Select($item)"
                               typeahead-template-url="/web/webjars/fk7263/webcert/views/diagnoseTemplate.html"
                               ng-change="limitDiagnosBeskrivningField('diagnosKod3')"
                               wc-to-uppercase>
                      </div>
                      <div class='col-xs-9'>
                        <div class="controls">
                          <input type="text" id="diagnoseDescriptionOpt2" name="diagnose.descriptionOpt2" value=""
                                 ng-model="cert.diagnosBeskrivning3" class="block col-xs-12 form-control maxwidth"
                                 typeahead="d.value as d.label for d in searchDiagnoseByDescription(form.diagnosKodverk, $viewValue) | filter:$viewValue "
                                 typeahead-on-select="onDiagnoseDescription3Select($item)"
                                 typeahead-template-url="/web/webjars/fk7263/webcert/views/diagnoseTemplate.html"
                                 typeahead-wait-ms="100"
                                 ng-change="limitDiagnosBeskrivningField('diagnosBeskrivning3')">
                          <span class="counter">Tecken kvar: {{inputLimits.diagnosBeskrivning - getTotalDiagnosBeskrivningLength()}}</span>
                        </div>
                      </div>
                    </div>

                    <div class="form-group">
                      <div>
                        <label class="control-label"><span message key="fk7263.label.diagnosfortydligande"></span></label>
                        <span wc-enable-tooltip field-help-text="fk7263.helptext.diagnos.fortydligande"></span>
                      </div>
                      <textarea id="diagnoseClarification" class="form-control" name="diagnose.clarification" rows='5'
                                ng-model="cert.diagnosBeskrivning" ng-trim="false"
                                ng-change="limitDiagnosBeskrivningField('diagnosBeskrivning')"></textarea>
                      <span class="counter">Tecken kvar: {{inputLimits.diagnosBeskrivning - getTotalDiagnosBeskrivningLength()}}</span>
                    </div>

                    <div class="form-group form-inline">
                      <label class="checkbox">
                        <input type="checkbox" id="diagnoseMultipleDiagnoses" name="diagnose.multipleDiagnoses"
                               ng-model="cert.samsjuklighet"
                               ng-change="limitDiagnosBeskrivningField('samsjuklighet')">
                        Samsjuklighet föreligger</label><span wc-enable-tooltip
                                                              field-help-text="fk7263.helptext.diagnos.samsjuklighet"></span>
                    </div>
                  </div>

                  <div wc-field field-label="fk7263.label.aktuellt-sjukdomsforlopp" field-number="3"
                       field-help-text="fk7263.helptext.aktuellt-sjukdomsforlopp" ng-hide="cert.avstangningSmittskydd"
                       ng-animate="fade">
                    <textarea id="diseaseCause" class="form-control" name="diseaseCause" rows='5'
                              ng-model="cert.sjukdomsforlopp" wc-maxlength ng-trim="false"
                              maxlength="{{inputLimits.sjukdomsforlopp}}"></textarea>
                  </div>

                  <div wc-field field-label="fk7263.label.funktionsnedsattningar" field-number="4"
                       field-help-text="fk7263.helptext.funktionsnedsattning" ng-hide="cert.avstangningSmittskydd"
                       ng-animate="'fade'">
                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.funktionsnedsattning" id="validationMessages_funktionsnedsattning">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.funktionsnedsattning"><span message
                                                                                                        key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>

                    <a class="soclink" href="http://www.socialstyrelsen.se/riktlinjer/forsakringsmedicinsktbeslutsstod"
                       target="_blank" title="Öppnar Socialstyrelsens beslutsstöd för angiven huvuddiagnos">Socialstyrelsens
                      försäkringsmedicinska beslutsstöd</a>
                    <textarea id="disabilities" class="form-control" name="disabilities" rows='6'
                              ng-model="cert.funktionsnedsattning" wc-maxlength ng-trim="false"
                              maxlength="{{inputLimits.funktionsnedsattning}}"></textarea>
                  </div>

                  <div wc-field field-label="fk7263.label.aktivitetsbegransning" field-number="5"
                       field-help-text="fk7263.helptext.aktivitetsbegransning" ng-hide="cert.avstangningSmittskydd"
                       ng-animate="'fade'" class="print-pagebreak-after">

                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.aktivitetsbegransning" id="validationMessages_aktivitetsbegransning">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.aktivitetsbegransning">
                          <span message key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>

                    <a class="soclink" href="http://www.socialstyrelsen.se/riktlinjer/forsakringsmedicinsktbeslutsstod"
                       target="_blank" title="Öppnar Socialstyrelsens beslutsstöd för angiven huvuddiagnos">Socialstyrelsens
                      försäkringsmedicinska beslutsstöd</a>
                    <textarea id="activityLimitation" class="form-control" name="activityLimitation" rows='10'
                              ng-model="cert.aktivitetsbegransning" wc-maxlength ng-trim="false"
                              maxlength="{{inputLimits.aktivitetsbegransning}}"></textarea>
                  </div>

                  <!-- Arbete -->
                  <div wc-field field-label="fk7263.label.arbete" field-number="8a"
                       field-help-text="fk7263.helptext.sysselsattning" ng-hide="cert.avstangningSmittskydd"
                       ng-animate="'fade'" id="arbeteForm">
                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.sysselsattning" id="validationMessages_sysselsattning">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.sysselsattning"><span message
                                                                                                  key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>

                    <div class="form-group form-inline">
                      <label class="control-label"><span message key="fk7263.label.arbetsformaga"></span></label>
                      <div class="controls form-inline">
                        <label class="checkbox"><input type="checkbox" id="arbeteNuvarande"
                                                       ng-model="cert.nuvarandeArbete"> Nuvarande
                          arbete</label><span wc-enable-tooltip
                                              field-help-text="fk7263.helptext.sysselsattning.nuvarande"></span>
                        <div class="indent" ng-if="cert.nuvarandeArbete">
                          <label for="currentWork">Ange aktuella arbetsuppgifter</label>
                          <div class="controls">
                            <textarea id="currentWork" class="" name="currentWork" rows='2'
                                      ng-model="form.nuvarandeArbetsuppgifter" wc-maxlength ng-trim="false"
                                      maxlength="{{inputLimits.nuvarandeArbetsuppgifter}}"></textarea>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="form-group form-inline">
                      <label class="checkbox"><input type="checkbox" id="arbeteArbetslos" ng-model="cert.arbetsloshet">
                        Arbetslöshet - att utföra arbete på den
                        reguljära arbetsmarknaden</label><span wc-enable-tooltip
                                                               field-help-text="fk7263.helptext.sysselsattning.arbetsloshet"></span>
                    </div>
                    <div class="form-group form-inline">
                      <label class="checkbox"><input type="checkbox" id="arbeteForaldraledig"
                                                     ng-model="cert.foraldrarledighet">
                        Föräldraledighet med föräldrapenning -
                        att vårda sitt barn</label><span wc-enable-tooltip
                                                         field-help-text="fk7263.helptext.sysselsattning.foraldrarledighet"></span>
                    </div>
                  </div>

                  <!-- Arbetsförmåga -->
                  <div wc-field field-label="fk7263.label.nedsattning" field-number="8b"
                       field-help-text="fk7263.helptext.arbetsformaga" class="arbetsformaga print-pagebreak-after"
                       id="arbetsformagaForm">
                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.arbetsformaga" id="validationMessages_arbetsformaga">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.arbetsformaga"><span message
                                                                                                 key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>

                    <div class="form-group form-inline">
                      Faktisk tjänstgöringstid <input style="width: 3em;" type="text" wc-decimal-number
                                                      id="capacityForWorkActualWorkingHoursPerWeek"
                                                      name="capacityForWork.actualWorkingHoursPerWeek" value=""
                                                      class='short control-element form-control' maxlength="5"
                                                      ng-model="cert.tjanstgoringstid"> <span>timmar/vecka</span> <span
                        wc-enable-tooltip
                        field-help-text="fk7263.helptext.arbetsformaga.faktisk-tjanstgoringstid"></span>
                    </div>

                    <!-- 25% -->
                    <div class="form-group form-inline">
                      <label class="checkbox" style="min-width: 280px"><input type="checkbox" id="nedsattMed25"
                                                                              name="capacityForWork.work25"
                                                                              ng-change="field8b.onChangeWorkStateCheck('nedsattMed25')"
                                                                              ng-model="field8b.nedsattMed25.workState">
                        25%
                        nedsatt arbetsförmåga från och med</label>
                      <span wc-date-picker-field target-model="cert.nedsattMed25.from"
                            on-change="onChangeNedsattMed('nedsattMed25', 'from')" dom-id="nedsattMed25from"
                            invalid="field8b.nedsattMed25.nedsattInvalidFrom"></span>
                      <span>till och med</span>
                      <span wc-date-picker-field target-model="cert.nedsattMed25.tom"
                            on-change="onChangeNedsattMed('nedsattMed25', 'tom')" dom-id="nedsattMed25tom"
                            invalid="field8b.nedsattMed25.nedsattInvalidTom"></span>
                      <div class="indent pad10" ng-if="field8b.nedsattMed25.workState">
                        <div class="workHoursPerWeek"
                             ng-show="cert.tjanstgoringstid != '' && cert.tjanstgoringstid > 0">
                          Arbetstid timmar/vecka: <strong id="arbetstid25">{{cert.tjanstgoringstid * 0.75 |
                          number}}</strong>
                        </div>
                        Arbetstidsförläggning (frivilligt) <input type="text"
                                                                  ng-model="form.ovrigt.nedsattMed25Beskrivning"
                                                                  id="nedsattMed25beskrivning"
                                                                  id="capacityForWork.rec25LongerWorkingHours"
                                                                  name="capacityForWork.rec25LongerWorkingHours"
                                                                  value="" class='form-control otherInformation'
                                                                  ng-change="limitOtherField('nedsattMed25Beskrivning')"
                                                                  wc-disable-key-down>
                        <span class="counter">Tecken kvar:  {{inputLimits.ovrigt - getTotalOvrigtLength()}}</span>
                        <div class="info-transfer">Informationen överförs till "Övriga upplysningar" vid PDF-utskrift av
                          blanketten.
                        </div>
                      </div>
                    </div>

                    <!-- 50% -->
                    <div class="form-group form-inline">
                      <label class="checkbox" style="min-width: 280px"><input type="checkbox" id="nedsattMed50"
                                                                              name="capacityForWork.work50"
                                                                              ng-change="field8b.onChangeWorkStateCheck('nedsattMed50')"
                                                                              ng-model="field8b.nedsattMed50.workState"> 50%
                        nedsatt arbetsförmåga från och med</label>
                      <span wc-date-picker-field target-model="cert.nedsattMed50.from"
                            on-change="onChangeNedsattMed('nedsattMed50', 'from')" dom-id="nedsattMed50from"
                            invalid="field8b.nedsattMed50.nedsattInvalidFrom"></span>
                      <span>till och med</span>
                      <span wc-date-picker-field target-model="cert.nedsattMed50.tom"
                            on-change="onChangeNedsattMed('nedsattMed50', 'tom')" dom-id="nedsattMed50tom"
                            invalid="field8b.nedsattMed50.nedsattInvalidTom"></span>
                      <div class="indent pad10" ng-if="field8b.nedsattMed50.workState">
                        <div class="workHoursPerWeek"
                             ng-show="cert.tjanstgoringstid != '' && cert.tjanstgoringstid > 0">
                          Arbetstid timmar/vecka: <strong id="arbetstid50">{{cert.tjanstgoringstid * 0.5 |
                          number}}</strong>
                        </div>
                        Arbetstidsförläggning (frivilligt) <input type="text"
                                                                  ng-model="form.ovrigt.nedsattMed50Beskrivning"
                                                                  id="nedsattMed50beskrivning"
                                                                  name="capacityForWork.rec50LongerWorkingHours"
                                                                  value="" class='form-control otherInformation'
                                                                  ng-change="limitOtherField('nedsattMed50Beskrivning')"
                                                                  wc-disable-key-down>
                        <span class="counter">Tecken kvar:  {{inputLimits.ovrigt - getTotalOvrigtLength()}}</span>
                        <div class="info-transfer">Informationen överförs till "Övriga upplysningar" vid PDF-utskrift av
                          blanketten.
                        </div>
                      </div>
                    </div>

                    <!-- 75% -->
                    <div class="form-group form-inline">
                      <label class="checkbox" style="min-width: 280px"><input type="checkbox" id="nedsattMed75"
                                                                              name="capacityForWork.work75"
                                                                              ng-change="field8b.onChangeWorkStateCheck('nedsattMed75')"
                                                                              ng-model="field8b.nedsattMed75.workState"> 75%
                        nedsatt arbetsförmåga från och med</label>
                      <span wc-date-picker-field target-model="cert.nedsattMed75.from"
                            on-change="onChangeNedsattMed('nedsattMed75', 'from')" dom-id="nedsattMed75from"
                            invalid="field8b.nedsattMed75.nedsattInvalidFrom"></span>
                      <span>till och med</span>
                      <span wc-date-picker-field target-model="cert.nedsattMed75.tom"
                            on-change="onChangeNedsattMed('nedsattMed75', 'tom')" dom-id="nedsattMed75tom"
                            invalid="field8b.nedsattMed75.nedsattInvalidTom"></span>
                      <div class="indent pad10" ng-if="field8b.nedsattMed75.workState">
                        <div class="workHoursPerWeek"
                             ng-show="cert.tjanstgoringstid != '' && cert.tjanstgoringstid > 0">
                          Arbetstid timmar/vecka: <strong id="arbetstid75">{{cert.tjanstgoringstid * 0.25 |
                          number}}</strong>
                        </div>
                        Arbetstidsförläggning (frivilligt) <input type="text"
                                                                  ng-model="form.ovrigt.nedsattMed75Beskrivning"
                                                                  id="nedsattMed75beskrivning"
                                                                  name="capacityForWork.rec75LongerWorkingHours"
                                                                  value="" class='form-control otherInformation'
                                                                  ng-change="limitOtherField('nedsattMed75Beskrivning')"
                                                                  wc-disable-key-down>
                        <span class="counter">Tecken kvar:  {{inputLimits.ovrigt - getTotalOvrigtLength()}}</span>
                        <div class="info-transfer">Informationen överförs till "Övriga upplysningar" vid PDF-utskrift av
                          blanketten.
                        </div>
                      </div>
                    </div>

                    <!-- 100% -->
                    <div class="form-group form-inline">
                      <label class="checkbox" style="min-width: 280px"><input type="checkbox" id="nedsattMed100"
                                                                              name="capacityForWork.workFull"
                                                                              ng-change="field8b.onChangeWorkStateCheck('nedsattMed100')"
                                                                              ng-model="field8b.nedsattMed100.workState"> Helt
                        nedsatt arbetsförmåga från och med</label>
                      <span wc-date-picker-field target-model="cert.nedsattMed100.from"
                            on-change="onChangeNedsattMed('nedsattMed100', 'from')" dom-id="nedsattMed100from"
                            invalid="field8b.nedsattMed100.nedsattInvalidFrom"></span>
                      <span>till och med</span>
                      <span wc-date-picker-field target-model="cert.nedsattMed100.tom"
                            on-change="onChangeNedsattMed('nedsattMed100', 'tom')" dom-id="nedsattMed100tom"
                            invalid="field8b.nedsattMed100.nedsattInvalidTom"></span>
                    </div>

                    <div ng-show="totalCertDays">
                      <p>Detta intyg motsvarar en period på: <span id="totalCertDays">{{totalCertDays}}</span> <span
                          ng-show="totalCertDays > 1">dagar</span><span ng-show="totalCertDays == 1">dag</span></p>
                    </div>
                    <div class="alert alert-warning" ng-show="datesOutOfRange">
                      De datum du angett är <strong>mer än en vecka före dagens datum eller mer än 6 månader framåt i
                      tiden</strong>. Du bör kontrollera att tidsperioderna är korrekta.
                    </div>
                    <div class="alert alert-warning" ng-show="datesPeriodTooLong">
                      De datum du angett innebär <strong>en period på mer än 6 månader</strong>. Du bör kontrollera att
                      tidsperioderna är korrekta.
                    </div>
                  </div>

                  <div wc-field field-label="fk7263.label.arbetsformaga.bedomning" field-number="9"
                       field-help-text="fk7263.helptext.arbetsformaga.bedoms-langre">
                    <a class="soclink" href="http://www.socialstyrelsen.se/riktlinjer/forsakringsmedicinsktbeslutsstod"
                       target="_blank" title="Öppnar Socialstyrelsens beslutsstöd för angiven huvuddiagnos">Socialstyrelsens
                      försäkringsmedicinska beslutsstöd</a>
                    <textarea id="capacityForWorkText" class="form-control" name="capacityForWork.text" rows='10'
                              ng-model="cert.arbetsformagaPrognos" wc-maxlength ng-trim="false"
                              maxlength="{{inputLimits.arbetsformagaPrognos}}"></textarea>
                  </div>

                  <!-- Prognos -->
                  <div wc-field field-label="fk7263.label.prognos" field-number="10"
                       field-help-text="fk7263.helptext.arbetsformaga.prognos" id="prognosForm">

                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.prognos" id="validationMessages_prognos">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.prognos"><span message
                                                                                           key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>

                    <a class="soclink" href="http://www.socialstyrelsen.se/riktlinjer/forsakringsmedicinsktbeslutsstod"
                       target="_blank" title="Öppnar Socialstyrelsens beslutsstöd för angiven huvuddiagnos">Socialstyrelsens
                      försäkringsmedicinska beslutsstöd</a>
                    <div class="form-group">
                      <label class="radio-inline"><input type="radio" name="capacityForWorkForecast" value="YES"
                                                         ng-model="form.prognos" checked="checked"> Ja</label>
                    </div>

                    <div class="form-group">
                      <label class="radio-inline"><input type="radio" id="capacityForWork2"
                                                         name="capacityForWorkForecast" value="PARTLY"
                                                         ng-model="form.prognos"> Ja, delvis</label>
                    </div>

                    <div class="form-group">
                      <label class="radio-inline"><input type="radio" id="capacityForWork3"
                                                         name="capacityForWorkForecast" value="NO"
                                                         ng-model="form.prognos"> Nej</label>
                    </div>

                    <div class="form-group">
                      <label class="radio-inline"><input type="radio" id="capacityForWork4"
                                                         name="capacityForWorkForecast" value="UNKNOWN"
                                                         ng-model="form.prognos"> Går ej att bedöma</label>
                      <div class="indent form-inline" ng-show="form.prognos == 'UNKNOWN'">
                        Förtydligande: <input type="text"
                                              ng-model="form.ovrigt.arbetsformagaPrognosGarInteAttBedomaBeskrivning"
                                              id="capacityForWorkForecastText" name="capacityForWork.forecastText"
                                              value="" class='form-control otherInformation'
                                              ng-change="limitOtherField('arbetsformagaPrognosGarInteAttBedomaBeskrivning')"> <span
                          id="prognosis-counter">Tecken kvar:
                        {{inputLimits.ovrigt - getTotalOvrigtLength()}}</span>
                        <div class="info-transfer">Informationen överförs till "Övriga upplysningar" vid PDF-utskrift av
                          blanketten.
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Åtgärder -->
                  <div wc-field field-label="fk7263.label.atgarder" field-number="6b"
                       ng-hide="cert.avstangningSmittskydd" field-help-text="fk7263.helptext.atgarder"
                       class="print-pagebreak-after">
                    <div class="form-group">
                      <label class="control-label">Planerad eller pågående behandling eller åtgärd inom sjukvården (ange
                        vilken)</label>
                      <textarea id="measuresCurrent" class="form-control" name="measures.current" rows='2'
                                ng-model="cert.atgardInomSjukvarden" wc-maxlength ng-trim="false"
                                maxlength="{{inputLimits.atgardInomSjukvarden}}"></textarea>
                    </div>

                    <div class="form-group">
                      <label class="control-label">Annan åtgärd (ange vilken)</label>
                      <textarea id="measuresOther" class="form-control" name="measures.other" rows='2'
                                ng-model="cert.annanAtgard" wc-maxlength ng-trim="false"
                                maxlength="{{inputLimits.annanAtgard}}"></textarea>
                    </div>
                  </div>

                  <!-- Rekommendationer -->
                  <div wc-field field-label="fk7263.label.rekommendationer" id="rekommendationerForm"
                       field-number="6a, 7, 11" field-help-text="fk7263.helptext.rekommendationer">

                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.rekommendationer" id="validationMessages_rekommendationer">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.rekommendationer"><span message
                                                                                                    key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>

                    <!-- 11 -->
                    <div>Resor till och från arbetet med annat färdmedel än normalt kan göra det möjligt för patienten
                      att återgå i arbete</label> <span wc-enable-tooltip
                                                        field-help-text="fk7263.helptext.rekommendationer.resor"></span>
                    </div>

                    <div class="form-group form-inline">
                      <label class="radio-inline">
                        <input type="radio" id="rekommendationRessatt" name="recommendationsToFk.travel" value="JA"
                               ng-model="form.ressattTillArbeteAktuellt"> Ja</label>
                      <label class="radio-inline">
                        <input type="radio" id="rekommendationRessattEj" name="recommendationsToFk.travel" value="NEJ"
                               ng-model="form.ressattTillArbeteAktuellt"> Nej</label>
                    </div>

                    <!-- 6a, 7 -->
                    <div ng-hide="cert.avstangningSmittskydd">

                      <!-- 6a -->
                      <div class="form-group form-inline">
                        <label class="checkbox"><input type="checkbox" id="rekommendationKontaktAf"
                                                       name="recommendationsToFk.contactAf"
                                                       ng-model="cert.rekommendationKontaktArbetsformedlingen">
                          Patienten
                          bör komma i kontakt med arbetsförmedlingen</label> <span wc-enable-tooltip
                                                                                   field-help-text="fk7263.helptext.rekommendationer.arbetsformedlingen"></span>
                      </div>
                      <div class="form-group form-inline">
                        <label class="checkbox"><input type="checkbox" id="rekommendationKontaktForetagshalsovard"
                                                       name="recommendationsToFk.contactCompanyCare"
                                                       ng-model="cert.rekommendationKontaktForetagshalsovarden">
                          Patienten
                          bör komma i kontakt med företagshälsovården</label> <span wc-enable-tooltip
                                                                                    field-help-text="fk7263.helptext.rekommendationer.foretagshalsovarden"></span>
                      </div>
                      <div class="form-group form-inline">
                        <label class="checkbox"><input type="checkbox" id="rekommendationOvrigt"
                                                       name="recommendationsToFk.other"
                                                       ng-model="cert.rekommendationOvrigtCheck"> Övrigt (ange
                          vad)</label><span wc-enable-tooltip
                                            field-help-text="fk7263.helptext.rekommendationer.ovrigt"></span>
                        <div class="indent" ng-if="cert.rekommendationOvrigtCheck">
                          <input type="text" id="rekommendationOvrigtBeskrivning" name="recommendationsToFk.otherText"
                                 value="" class='form-control maxwidth' ng-model="form.rekommendationOvrigt"
                                 maxlength="80" wc-maxlength>

                        </div>
                      </div>

                      <!-- 7 -->
                      <h4 class="inline-block">Är arbetslivsinriktad rehabilitering aktuell?</h4><span wc-enable-tooltip
                                                                                                       field-help-text="fk7263.helptext.rekommendationer.arbetslivsinriktad-rehabilitering"></span>

                      <!-- Rehab -->
                      <!-- YES -->
                      <div class="form-group">
                        <label class="radio-inline"><input type="radio" name="recommendationsToFkReabInQuestion"
                                                           value="JA" ng-model="form.rehab" id="rehabYes"> Ja</label>
                      </div>

                      <!-- NO -->
                      <div class="form-group">
                        <label class="radio-inline"><input type="radio" name="recommendationsToFkReabInQuestion"
                                                           group="group3" value="NEJ" ng-model="form.rehab"
                                                           checked="checked" id="rehabNo"> Nej</label>
                      </div>

                      <!-- GÅR EJ ATT BEDÖMA -->
                      <div class="form-group">
                        <label class="radio-inline"><input type="radio" name="recommendationsToFkReabInQuestion"
                                                           group="group3" value="GAREJ" ng-model="form.rehab" id="garej"> Går inte
                          att bedöma</label>
                      </div>
                    </div>
                  </div>

                  <div wc-field field-label="fk7263.label.fk-kontakt" field-number="12"
                       field-help-text="fk7263.helptext.kontakt">
                    <label><input type="checkbox" id="kontaktFk" name="contactWithFkRequested"
                                  ng-model="cert.kontaktMedFk"> Kontakt önskas med
                      Försäkringskassan</label>
                  </div>

                  <div wc-field field-label="fk7263.label.ovrigt" field-number="13"
                       field-help-text="fk7263.helptext.ovrigt" class="print-pagebreak-after">
                    <textarea id="otherInformation" name="otherInformation" rows='10'
                              class='form-control otherInformation' ng-model="cert.kommentar"
                              ng-change="limitOtherField('kommentar')"></textarea>
                    <div class="counter">Tecken kvar: {{inputLimits.ovrigt - getTotalOvrigtLength()}}</div>
                  </div>

                  <div wc-field field-label="fk7263.label.vardenhet.adress" field-number="15"
                       field-help-text="fk7263.helptext.adress" id="vardenhetForm">
                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.vardperson" id="validationMessages_vardperson">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.vardperson"><span message
                                                                                              key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>

                    <label class="control-label">{{cert.grundData.skapadAv.vardenhet.enhetsnamn}}
                      ({{cert.grundData.skapadAv.vardenhet.enhetsid}}),
                      {{cert.grundData.skapadAv.vardenhet.vardgivare.vardgivarnamn}}</label>

                    <div class="alert alert-info" ng-show="widgetState.hasInfoMissing">
                      Information om vårdenheten saknas i HSA-katalogen. Be den på vårdenheten som är ansvarig för
                      frågor om HSA att uppdatera informationen.
                    </div>

                    <div class="form-horizontal">
                      <div class="form-group">
                        <label class="col-xs-3 control-label">Postadress</label>
                        <div class="col-xs-9">
                          <input type="text" class="form-control input-full" id="clinicInfoPostalAddress"
                                 name="clinicInfo.postalAddress"
                                 ng-model="cert.grundData.skapadAv.vardenhet.postadress">
                        </div>
                      </div>
                      <div class="form-group">
                        <label class="col-xs-3 control-label">Postnummer</label>
                        <div class="col-xs-9">
                          <input type="text" class="form-control input-5" id="clinicInfoPostalCode"
                                 name="clinicInfo.postalCode" ng-model="cert.grundData.skapadAv.vardenhet.postnummer">
                        </div>
                      </div>
                      <div class="form-group">
                        <label class="col-xs-3 control-label">Postort</label>
                        <div class="col-xs-9">
                          <input type="text" class="form-control" id="clinicInfoPostalCity" name="clinicInfo.postalCity"
                                 ng-model="cert.grundData.skapadAv.vardenhet.postort">
                        </div>
                      </div>
                      <div class="form-group">
                        <label class="col-xs-3 control-label">Telefonnummer</label>
                        <div class="col-xs-9">
                          <input type="text" class="form-control" id="clinicInfoPhone" name="clinicInfo.phone"
                                 ng-model="cert.grundData.skapadAv.vardenhet.telefonnummer" >
                        </div>
                      </div>
                    </div>
                  </div>

                  <div wc-field-signing-doctor></div>

                </div>
                <!-- cert body -->

              </div>
              <!-- certificate -->

              <div ng-if="!isSigned" class="print-hide">

                <h3><span message key="common.sign.intyg"></span></h3>

                <div ng-if="!user.userContext.lakare">
                  <div id="sign-requires-doctor-message-text" class="alert alert-info">
                    <span message key="draft.onlydoctorscansign"></span>
                  </div>

                  <div wc-feature-not-active feature="franJournalsystem">
                    <p>
                      <span message key="draft.notifydoctor"></span>
                    </p>
                    <div class="form-group">
                      <button id="vidarebefordraEjHanterad" class="btn"
                              ng-class="{'btn-info': !certMeta.vidarebefordrad, 'btn-default btn-secondary' : certMeta.vidarebefordrad}"
                              title="Skicka mejl med en länk till utkastet för att informera den läkare som ska signera det."
                              ng-click="openMailDialog()">
                        <img ng-if="!certMeta.vidarebefordrad" src="/img/mail.png"> <img ng-if="certMeta.vidarebefordrad"
                                                                                         src="/img/mail_dark.png">
                      </button>
                    </div>

                    <div class="body-row">
                      <label for="mark-as-vidarebefordrad">
                        <input id="mark-as-vidarebefordrad" type="checkbox"
                               ng-disabled="widgetState.vidarebefordraInProgress" ng-model="certMeta.vidarebefordrad"
                               ng-change="onVidarebefordradChange()" /> Vidarebefordrad
                      </label> <span ng-if="widgetState.vidarebefordraInProgress"> <img
                        src="/img/ajax-loader-kit-16x16.gif"></span>
                    </div>
                  </div>
                </div>

                <button id="signera-utkast-button" class="btn btn-success" ng-disabled="!isComplete || certForm.$dirty || signingWithSITHSInProgress"
                        ng-click="sign()" ng-show="user.userContext.lakare"><img ng-show="signingWithSITHSInProgress" ng-src="/img/ajax-loader-small-green.gif"/> <span message key="common.sign"></span>
                </button>

              </div>

            </div>
          </div>

          <wc-disable-key-down wc-disable-key-down-elements=":text,:checkbox,:radio" wc-disable-key-down-done-loading="widgetState.doneLoading" />

        </form>
      </div>

    </div>
    <!-- span12 webcert-col-single -->
  </div>
  <!-- row -->
</div> <!-- container -->
