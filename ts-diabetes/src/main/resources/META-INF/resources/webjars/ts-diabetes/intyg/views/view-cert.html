<!--

    Copyright (C) 2013 Inera AB (http://www.inera.se)

    This file is part of Inera Certificate Modules (http://code.google.com/p/inera-certificate-modules).

    Inera Certificate Modules is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    Inera Certificate Modules is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

-->
<div class="row-fluid">

  <!-- Loading spinner: visibility defined by $scope.doneLoading  -->
  <div ng-hide="doneLoading" style="text-align: center; padding: 20px;">
    <img src="/img/ajax-loader.gif" style="text-align: center;" />
    <p style="text-align: center; color: #64ABC0; margin-top: 20px;">
      <strong><message key="ts-diabetes.message.certificateloading" /></strong>
    </p>
  </div>

  <div ng-show="doneLoading">
    <div id="backnav" class="row col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <a class="backlink" href="/web/start"><message key="ts-diabetes.button.goback" /></a>
    </div>

    <!-- Content -->
    <div class="row">
      <div class="col-xs-12 col-sm-7 col-md-7 col-lg-7">
        <h1>
          <message key="ts-diabetes.label.pagetitle" />
        </h1>
        <p></p>
        <p>
        	<message key="ts-diabetes.label.pageingress" />
        </p>
        <div collapse="!isCollapsed1" class="collapse">
        	<p>
	            <message key="ts-diabetes.label.pagedescription" />
	        </p>
	        <div message key="ts-diabetes.label.pagedescription.error.in.certificate.header"></div>
	        <div message key="ts-diabetes.label.pagedescription.error.in.certificate"></div>
        </div>
        <a ng-click="isCollapsed1 = !isCollapsed1" data-toggle="collapse" message key="ts-diabetes.label.status.{{ !isCollapsed1 }}">{{ts-diabetes.label.status.{{ !isCollapsed1 }}</a>
      </div>
      <div class="col-xs-12 col-sm-5 col-md-5 col-lg-5">
        <h2>
          <span message key="ts-diabetes.label.latestevent"></span>
        </h2>
		
		<!-- Show if no events to show -->
        <div ng-show="cert.status.length<1">
        	<p>
        		<span message key="ts-diabetes.label.latestevent.noevents"></span>
        	</p>
        </div>
		
		<!-- Show if more than one event exists -->
   		<div ng-show="cert.status.length>0">
            <span message key="ts-diabetes.status.{{cert.status[0].type}}"></span>
            <span ng-show="cert.statuses[0].type == 'SENT'"></span>
            <span message key="ts-diabetes.target.{{cert.status[0].target}}"></span>
            <span class="certificate-event-timestamp pull-right">{{cert.status[0].timestamp | date:'shortDate'}}</span>
            <div collapse="!isCollapsedCertEvents" class="collapse">
              <div ng-repeat="status in cert.status" ng-switch on="$index > 0">
                <div ng-switch-when="true">
                  <span message key="ts-diabetes.status.{{cert.status[0].type}}"></span>
                  <span ng-show="status.type == 'SENT'"></span>
                  <span message key="ts-diabetes.target.{{cert.status[0].target}}"></span>
                  <span class="certificate-event-timestamp pull-right">{{status.timestamp | date:'shortDate'}}</span><br>
                </div>
              </div>
            </div>
            <p>
              <a ng-show="cert.status.length>1" ng-click="isCollapsedCertEvents = !isCollapsedCertEvents" data-toggle="collapse" message key="ts-diabetes.label.showevents.{{ !isCollapsedCertEvents }}">{{ts-diabetes.label.showevents.{{ !isCollapsedCertEvents }}</a>
            </p>
        </div>
    </div>
    </div>

    <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 ">
    <form id="view-as-pdf" action="{{downloadAsPdfLink}}" method="get" target="_blank" name="pdfForm">
          <p class="btn-row">
            <button type="button" ng-click="send()" class="btn btn-success" title="{{messageService.getProperty('ts-diabetes.button.send.certificate.title')}}">
              <message key="ts-button.detail.send" />
            </button>
            <button id="downloadprint" type="submit" ng-click="document.pdfForm.submit()" class="btn btn-inverse">
              <message key="ts-diabetes.button.downloadprint" />
            </button>
          </p>
        </form>
       </div>
    </div>
    <section id="certificate" class="certificate">
      <span class="hide" id="certId" title="{{cert.id}}"></span> <span class="hide" id="certType" title="{{cert.typ}}"></span>
      <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
          <div class="cert">
            <div class="cert-titlebar">
              <img class="cert-icon" alt="" ng-src="/web/webjars/ts-bas/intyg/img/ts-bas.png" src="/web/webjars/ts-diabetes/intyg/img/ts-diabetes.png">
              <div class="row">
                <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                  <h2>
                    <span class="cert-title"><message key="ts-diabetes.label.certtitle" /></span>
                    <span class="cert-titlebar-type"><span message key="ts-diabetes.typename"></span></span>
                  </h2>
                </div>
                <div class="col-xs-12 col-sm-5 col-md-5 col-lg-5 issue">
                  <span><message key="ts-diabetes.label.issued" /></span> <span class="cert-titlebar-value">{{cert.signeringsdatum | date:'longDate'}}</span>
                </div>
				<div class="col-xs-2 col-sm-1 col-md-1 col-lg-1 archive hidden-xs">
                  <a role="button" data-toggle="modal" title="{{messageService.getProperty('button.alt.archive')}}" ng-click="openArchiveDialog(cert)">
                      <span class="glyphicon glyphicon-folder-close white"></span>
					  <!-- <img alt="Arkivera intyg" src="/img/archive-icon.gif" /> -->
                  </a>
                </div>
              </div>
            </div>
            <div class="cert-header">
              <div class="row">
                <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                  <span class="tag"><message key="ts-diabetes.label.patientname" /></span> <span id="patient-name">{{cert.patient.fullstandigtNamn}}</span>
                </div>
                <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                  <span class="tag"><message key="ts-diabetes.label.civicnumber" /></span> <span id="patient-crn">{{cert.patient.personid}}</span>
                </div>
                <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 col-xs-offset-6 col-sm-offset-6 col-md-offset-6 col-lg-offset-6 margin-top-5px">
                  <span class="tag"><message key="ts-diabetes.label.identitet" /></span> <span id="patient-crn">{{cert.vardkontakt.idkontroll}}</span>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                  <span class="tag"><message key="ts-diabetes.label.unit" /></span> <span id="careunit">{{cert.skapadAv.vardenhet.enhetsnamn}}</span>
                </div>
                <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                  <span class="tag"><message key="ts-diabetes.label.issuer" /></span> <span id="caregiver">{{cert.skapadAv.vardenhet.vardgivare.vardgivarnamn}}</span>
                </div>
              </div>
              <div class="row">
              	<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                  <span class="tag"><message key="ts-diabetes.label.intygavser" /></span> 
        
                  <span class="text no-padding-bottom">
                      <span class="ts-cert-answer">{{intygAvser}}</span>
                  </span>

                </div>
                <div class="col-xs-6 hidden-sm hidden-md hidden-lg pull-right">
                	<button class="btn btn-primary pull-right" ata-toggle="modal" title="{{messageService.getProperty('button.alt.archive')}}" ng-click="openArchiveDialog(cert)">
                		<span class="glyphicon glyphicon-folder-close white"></span>
                	</button>
                </div>
              </div>
            </div>
            
            <div class="table-bottom"></div>
            <div class="cert-body">
                <div class="body-row">
                    <h3 class="title">
                        <span message key="ts-diabetes.label.allmant"></span>
                            <span>
                                <span></span>
                            </span>
                    </h3>
                    <span class="text no-padding-bottom">
                        <span message key="ts-diabetes.label.diabetes.diabetestyp"></span>
                        <span class="ts-cert-answer" message key="ts-diabetes.label.diabetes.diabetestyp.{{cert.diabetes.diabetestyp}}"></span>
                    </span>
                    <span class="text no-padding-bottom">
                        <span message key="ts-diabetes.label.diabetes.behandling"></span><br>
                        <span message key="ts-diabetes.label.diabetes.behandling.endast-kost"></span>
                        <span class="ts-cert-answer" message key="{{cert.diabetes.endastKost | BoolToTextFilter}}"></span>

                        <span message key="ts-diabetes.label.diabetes.behandling.tabletter"></span>
                        <span class="ts-cert-answer" message key="{{cert.diabetes.tabletter | BoolToTextFilter}}"></span>

                        <span message key="ts-diabetes.label.diabetes.behandling.insulin"></span>
                        <span class="ts-cert-answer" message key="{{cert.diabetes.insulin | BoolToTextFilter}}"></span>
                       
                        <span ng-show="cert.diabetes.insulinBehandlingsperiod.length > 0">
                        <br>
                            <span message key="ts-diabetes.label.diabetes.behandling.insulin-period"></span>
                            <span class="ts-cert-answer">{{cert.diabetes.insulinBehandlingsperiod}}</span>
                        </span>
                    </span>
                    <span class="text">
                        <span message key="ts-diabetes.label.diabetes.behandling.annan"></span>
                        <span class="ts-cert-answer" message key="{{cert.diabetes.annanBehandling | BoolToTextFilter}}"></span>
                        <span ng-show="cert.diabetes.annanBehandling">
                        <br>
                            <span message key="ts-diabetes.label.diabetes.behandling.annan.period"></span>
                            <span class="ts-cert-answer">{{cert.diabetes.annanBehandlingBeskrivning}}</span>
                        </span>
                    </span>
                    
                </div>
                <div class="body-row">
                    <h3 class="title">
                        <span message key="ts-diabetes.label.hypoglykemier"></span>
                            <span>
                                <span></span>
                            </span>
                    </h3>
                    <span class="text no-padding-bottom">
                        <span message key="ts-diabetes.label.hypoglykemier.har-patient-kannedom"></span>
                        <span class="ts-cert-answer" message key="{{cert.hypoglykemier.kunskapOmAtgarder | BoolToTextFilter}}"></span>
                    </span>

                    <span class="text no-padding-bottom">
                        <span message key="ts-diabetes.label.hypoglykemier.tecken-nedsatt-hjarnfunktion"></span>
                        <span class="ts-cert-answer" message key="{{cert.hypoglykemier.teckenNedsattHjarnfunktion | BoolToTextFilter}}"></span>
                    </span>

                    <span class="text no-padding-bottom">
                        <span message key="ts-diabetes.label.hypoglykemier.saknar-formaga-kanna-varningstecken"></span>
                        <span class="ts-cert-answer" message key="{{cert.hypoglykemier.saknarFormagaKannaVarningstecken | BoolToTextFilter}}"></span>
                    </span>

                    <span class="text no-padding-bottom">
                        <span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst"></span>
                        <span class="ts-cert-answer" message key="{{cert.hypoglykemier.allvarligForekomst | BoolToTextFilter}}"></span>

                        <span ng-show="cert.hypoglykemier.allvarligForekomstBeskrivning">
                            <br>
                            <span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst.beskrivning"></span>
                            <span class="ts-cert-answer">{{cert.hypoglykemier.allvarligForekomstBeskrivning}}</span><br>
                        </span>                        
                    </span>

                    <span class="text">
                        <span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst-trafiken"></span>
                        <span class="ts-cert-answer" message key="{{cert.hypoglykemier.allvarligForekomstTrafiken | BoolToTextFilter}}"></span>                        
                        <span ng-show="cert.hypoglykemier.allvarligForekomstTrafikBeskrivning.length > 0">
                            <br>
                            <span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst-trafiken.beskrivning"></span>
                            <span class="ts-cert-answer">{{cert.hypoglykemier.allvarligForekomstTrafikBeskrivning}}</span>
                        </span>
                    </span>

                </div>

                <div class="body-row">
                    <h3 class="title">
                        <span message key="ts-diabetes.label.syn"></span>
                            <span>
                                <span></span>
                            </span>
                    </h3>
                    <span class="text no-padding-bottom">
                        <span message key="ts-diabetes.label.syn.separat-ogonlakarintyg"></span>
                        <span class="ts-cert-answer" message key="{{cert.syn.separatOgonlakarintyg | BoolToTextFilter}}"></span>
                    </span>
                    <span class="text no-padding-bottom">
                        <span message key="ts-diabetes.label.syn.synfaltsprovning-utan-anmarkning"></span>
                        <span class="ts-cert-answer" message key="{{cert.syn.synfaltsprovningUtanAnmarkning | BoolToTextFilter}}"></span>
                    </span>
            		<span class="text no-padding-bottom">
                        <span message key="ts-diabetes.label.syn.synskarpa"></span>
                    </span>
                    <span class="text ts-text-field-wide">
                    	<table class="table table-condensed ts-table">
							<tr>
							    <th></th>
							    <th>Utan korrektion</th>
							    <th>Med korrektion</th>
							</tr>
						    <tr>
						        <td>Höger öga</td>
						        <td><span class="text">{{cert.syn.hoger.utanKorrektion | number : 1}}</span></td>
						        <td><span class="text">{{cert.syn.hoger.medKorrektion | number : 1}}</span></td>
						    </tr>
						    <tr>
						        <td>Vänster öga</td>
       					        <td><span class="text">{{cert.syn.vanster.utanKorrektion | number : 1}}</span></td>
						        <td><span class="text">{{cert.syn.vanster.medKorrektion | number : 1}}</span></td>
						    </tr>
						    <tr>
						        <td>Binokulärt</td>
      					        <td><span class="text">{{cert.syn.binokulart.utanKorrektion | number : 1}}</span></td>
						        <td><span class="text">{{cert.syn.binokulart.medKorrektion | number : 1}}</span></td>
						    </tr>
						</table>
                    </span>
					<span class="text">
                        <span message key="ts-diabetes.label.syn.diplopi"></span>
                        <span class="ts-cert-answer" message key="{{cert.syn.diplopi | BoolToTextFilter}}"></span>
                    </span>
                </div>

            	<div class="body-row">
            		<h3 class="title">
            			<span message key="ts-diabetes.label.bedomning">{{ts-diabetes.label.bedomning}}</span>
            			<span>
            				<span></span>
            			</span>
            		</h3>
      				<div ng-show="!cert.bedomning.kanInteTaStallning">
                        <span class="text no-padding-bottom" message key="ts-diabetes.label.bedomning-info-alt-1"></span>
    
                        <span class="text no-padding-bottom">
                            <span class="ts-cert-answer">{{intygAvser}}</span>
                        </span>
                   </div>
            				
            		<div ng-show="cert.bedomning.kanInteTaStallning">
            		    <span class="text">{{ts-bas.label.bedomning-info-alt-2}}</span>
            		</div>
            				
           			<span class="text no-padding-bottom">
           			    <span class="ts-cert-answer" message key="ts-diabetes.label.bedomning-info-undersokas-med-specialkompetens"></span><br>
           			    <span ng-show="cert.bedomning.lakareSpecialKompetens.length > 0">{{cert.bedomning.lakareSpecialKompetens}}</span>
           			    <span ng-show="!cert.bedomning.lakareSpecialKompetens" message key="ts-diabetes.label.bedomning-info-ej-angivet"></span>
     			    </span>

                    <span class="text" >
                        <span message key="ts-diabetes.label.bedomning.lamplighet-inneha"></span><br>
                        <span class="ts-cert-answer" message key="{{cert.bedomning.lamplighetInnehaBehorighet | BoolToTextFilter}}"></span>
                    </span>
            	</div>
            	
                <div class="body-row" ng-show="cert.kommentar.length > 0">
            		<h3 class="title">
                        <span message key="ts-diabetes.label.ovrigkommentar"></span>
            			<span>
            				<span></span>
            			</span>
            		</h3>                
                    <span class="text">
                        <span>{{cert.kommentar}}</span>                       
                    </span>
                </div>
                
                <div class="row padding-bottom-30px">
            		<div class="col-xs-12 col-sm-7 col-md-7 col-lg-7">
            			<div class="infobox">
            				<h3><span message key="ts-diabetes.label.confirmedby">{{ts-diabetes.label.confirmedby}}</span></h3>
            				<h4><span message key="ts-diabetes.label.date">{{ts-diabetes.label.date}}</span></h4>
            				<p>{{cert.signeringsdatum | date:'longDate'}}</p>
            				<h4><span message key="ts-diabetes.label.contactinfo"></span></h4>
            				<p>
            					<span id="physician-name-id" class="text">{{cert.skapadAv.fullstandigtNamn}}</span><br/>
            					<!-- <span id="caregiver-name-id" class="text">{{cert.skapadAv.vardenhet.vardgivare.vardgivarnamn}} ({{cert.skapadAv.vardenhet.vardgivare.vardgivarid}})</span><br/> -->
            					<span id="careunit-name-id" class="text">{{cert.skapadAv.vardenhet.enhetsnamn}}</span><br/>
            					<span id="careunit-postal_address" class="text">{{cert.skapadAv.vardenhet.postadress}}<br/> 
            					{{cert.skapadAv.vardenhet.postnummer}} {{cert.skapadAv.vardenhet.postort}}</span><br/>
            					<span id="careunit-postal_phone" class="text">{{cert.skapadAv.vardenhet.telefonnummer}}, {{cert.skapadAv.vardenhet.telefonnummer}}</span>
            				</p>
            			</div>
            		</div>
            	</div>

            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

</div>
