#set( $symbol_pound = '#' )
#set( $symbol_dollar = '$' )
#set( $symbol_escape = '\' )
<!--

    Copyright (C) 2013 Inera AB (http://www.inera.se)

    This file is part of Inera Certificate Modules (http://code.google.com/p/inera-certificate-modules).

    Inera Certificate Modules is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    Inera Certificate Modules is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

-->
<div class="row-fluid">

  <!-- Loading spinner: visibility defined by ${symbol_dollar}scope.doneLoading  -->
  <div ng-hide="doneLoading" style="text-align: center; padding: 20px;">
    <img src="/img/ajax-loader.gif" style="text-align: center;" />
    <p style="text-align: center; color: ${symbol_pound}64ABC0; margin-top: 20px;">
      <strong><message key="view.message.certificateloading" /></strong>
    </p>
  </div>

  <div ng-show="doneLoading">
    <!-- Modals: visibility defined by ${symbol_dollar}scope.doneLoading -->
    <div modal="shouldBeOpen" close="close()" options="opts">
      <div class="modal-header">
        <button class="close" ng-click="close()">×</button>
        <h3>Intyget har skickats till Försäkringskassan</h3>
      </div>
      <div class="modal-body">
        <p>Ärendet behandlas nu av Försäkringskassan.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" ng-click="close()">OK</button>
      </div>
    </div>

    <div id="backnav" class="row-fluid">
      <a class="backlink" href="/web/start"><message key="button.goback" /></a>
    </div>



    <!-- Content -->

    <div class="row-fluid">
      <div class="span7">
        <h1>
          <message key="view.label.pagetitle" />
        </h1>
        <p>
          <message key="view.label.pagedescription" />
        </p>
        <form id="view-as-pdf" action="{{'/moduleapi/certificate/' + cert.utlatandeid + '/pdf'}}" method="get" target="_blank">
          <p class="btn-row">
            <button type="button" ng-click="open()" class="btn btn-success">
              <message key="button.send" />
            </button>
            <button id="downloadprint" type="submit" class="btn btn-inverse">
              <message key="button.downloadprint" />
            </button>
          </p>
        </form>
      </div>
      <div class="span5 eventbox">
        <h2>
          <span message key="view.label.latestevent"></span>
        </h2>
        <!--  Show if no events to show -->
        <p ng-show="!cert.status">
          <span message key="view.label.latestevent.noevents"></span></a>
        </p>

        <!-- Show first status in list if any viable status exist-->
        <p id="lastest-certificate-event" ng-show="cert.status.length>0">
          {{cert.status[0].timestamp | date:'shortDate'}} <span message key="${artifactId}.status.{{cert.status[0].type}}"></span> <span message
            key="${artifactId}.target.{{cert.status[0].target}}"></span>
        </p>
        <!-- Show if more than 1 viable status exists -->
        <p ng-show="cert.status.length>1">
          <a class="statusHistoryLink" href ng-click="showStatusHistory()"><span message key="view.label.latestevent.showall"></span></a>
        </p>
      </div>
    </div>
    <section id="certificate" class="certificate">
      <span class="hide" id="certId" title="{{cert.id}}"></span> <span class="hide" id="certType" title="{{cert.typ}}"></span>
      <div class="row-fluid">
        <div class="span12">
          <div class="cert">
            <div class="cert-titlebar">
              <div class="row-fluid">
                <div class="span6">
                  <h2>
                    <span><message key="view.label.certtitle" /></span>
                  </h2>
                </div>
                <div class="span5 issue">
                  <span><message key="view.label.issued" /></span> <span class="cert-titlebar-value">{{cert.signeringsdatum | date:'longDate'}}</span>
                </div>
                <div class="span1 archive">
                  <a href="${symbol_pound}archiveModal" role="button" data-toggle="modal" onclick="return false"><img alt="Arkivera intyg" src="/img/archive-icon.gif" /></a>
                </div>
              </div>
            </div>
            <div class="cert-header">
              <div class="row-fluid">
                <div class="span6">
                  <span class="tag"><message key="view.label.patientname" /></span> <span id="patient-name">{{cert.patient.fullstandigtNamn}}</span>
                </div>
                <div class="span6">
                  <span class="tag"><message key="view.label.unit" /></span> <span id="careunit">{{cert.skapadAv.vardenhet.enhetsnamn}}</span>
                </div>
              </div>
              <div class="row-fluid">
                <div class="span6">
                  <span class="tag"><message key="view.label.civicnumber" /></span> <span id="patient-crn">{{cert.patient.personid}}</span>
                </div>
                <div class="span6">
                  <span class="tag"><message key="view.label.issuer" /></span> <span id="caregiver">{{cert.skapadAv.vardenhet.vardgivare.vardgivarnamn}}</span>
                </div>
              </div>

            </div>
            <div class="cert-body">

				  <div class="body-row">
	              	<h3>Information om den avbeställda resan</h3>
	                <span class="title">Bokningsnummer</span> <span id="travel-booking-ref" class="text">{{cert.arrangemang.bokningsreferens}}</span><br/>
	                <span class="title">Resmål</span> <span id="travel-destination" class="text">{{cert.arrangemang.plats}}</span><br/>
	                <span class="title">Datum då resan bokades</span> <span id="travel-booking-date" class="text">{{cert.arrangemang.bokningsdatum | date:'longDate'}}</span><br/>
	                <span class="title">Datum för avresa</span> <span id="travel-departure-date" class="text">{{cert.arrangemang.arrangemangsdatum}}</span><br/>
	                <span class="title">Datum då resan avbeställdes</span> <span id="travel-cancel-date" class="text">{{cert.arrangemang.avbestallningsdatum | date:'longDate'}}</span>
	              </div>

	              <div class="body-row" ng-switch on="cert.rekommendation.rekommendationskod">
					<h3>Läkares rekommendation</h3>
	              	<span class="title">Rekommendation</span>
	              	<span ng-switch-when="REK1" class="text">Jag avråder uttryckligen från resa, då patientens = resenärens tillstånd innebär, att sådan ej kan genomföras utan men.</span>
	              	<span ng-switch-when="REK2" class="text">Jag avråder ej från resa. Patientens = resenärens tillstånd utgör inget hinder för resa.</span>
	              	<span ng-switch-when="REK3" class="text">Jag avråder uttryckligen från resa. Komplikationer i graviditeten har uppkommit efter bokning av resan, vilka innebär hinder för resa.</span>
	                <span ng-switch-when="REK4" class="text">Jag avråder ej från resa. Graviditeten utgör inget medicinskt hinder för resa.</span>
	                <span ng-switch-when="REK5" class="text">Resenären, som är nära anhörig till patienten, bör ej genomföra resan. Detta emedan patientens tillstånd är allva${artifactId}gt.</span>
	                <span ng-switch-when="REK6" class="text">Resenären, som är nära anhörig till patienten, bör ej genomföra resan. Detta emedan patientens tillstånd föranleder speciell omvårdnad genom resenärens försorg.</span>
	                <span ng-switch-when="REK7" class="text">Jag avråder ej från resa. Patientens = anhörig till resenären, tillstånd utgör inget hinder för resenären att resa.</span>
	              </div>

	              <div class="body-row" ng-show="cert.undersokning.orsakforavbokning == 'RESENAR_GRAVID'">
	              	<h3>Förlossningsdetaljer</h3>
	              	<span class="title">Beräknat födelsedatum</span>
	              	<span class="text">Barnet beräknas födas {{cert.undersokning.graviditet.beraknatForlossningsdatum}}</span>

	              </div>

	              <div class="body-row">
	              	<h3>Om den akutella sjukdomen/komplikationen</h3>
			<div ng-show="cert.undersokning.forstaUndersokningsdatum">
	                  <span class="title">Datum för första undersökning</span> <span id="examination-first-date" class="text">{{cert.undersokning.forstaUndersokningsdatum | date:'longDate'}}</span><br/></div>
			<div ng-show="cert.undersoking.forstaUndersokningsplats">
	                  <span class="title">Plats för första undersökning</span> <span id="examination-first-place" class="text">{{cert.undersokning.forstaUndersokningsplats}}</span>
			</div><br/>
	                <span class="title">Datum för undersökning</span> <span id="examination-date" class="text">{{cert.undersokning.undersokningsdatum | date:'longDate'}}</span><br/>
	                <span class="title">Plats för undersökning</span> <span id="examination-place" class="text">{{cert.undersokning.utforsVid.enhetsnamn}}</span>
	              </div>

	              <div class="body-row" ng-show="cert.rekommendation.sjukdomskannedom != 'SJK4'" ng-switch on="cert.rekommendation.sjukdomskannedom">
	              	<h3>Sjukdomskännedom</h3>
	              	<span class="title">Beskrivning</span>
	                <span ng-switch-when="SJK1" class="text">Sjukdomen/komplikationen var okänd vid bokningstillfället.</span>
	                <span ng-switch-when="SJK2" class="text">Patientens sjukdom/komplikation är kronisk, var känd vid inbokningstillfället och utgjorde då inget hinder för resan. Tillståndet har nu förvärrats på ett sätt som vid bokningstillfället ej var möjligt att förutse</span>
	                <span ng-switch-when="SJK3" class="text">Patientens sjukdom/komplikation är kronisk, var känd vid inbokningstillfället och utgjorde då inget hinder för resan. Tillståndet har nu förvärrats på ett sätt som vid bokningstillfället var möjligt att förutse</span>
	              </div>

	              <div class="body-row" ng-show="cert.rekommendation.sjukdomskannedom == 'SJK4'">
	              	<h3>Sjukdomskännedom</h3>
	              	<span class="title">Beskrivning</span>
	              	<span class="text">{{cert.rekommendation.beskrivning}}</span>
	              </div>

	              <div class="body-row">
	              	<h3>Utfärdare</h3>
	              	<span class="title">Läkare</span> <span id="physician-name-id" class="text">{{cert.skapadAv.fullstandigtNamn}} ({{cert.skapadAv.personid}})</span><br/>
	              	<span class="title">Vårdgivare</span> <span id="caregiver-name-id" class="text">{{cert.skapadAv.vardenhet.vardgivare.vardgivarnamn}} ({{cert.skapadAv.vardenhet.vardgivare.vardgivarid}})</span><br/>
	                <span class="title">Vårdenhetens namn och id</span> <span id="careunit-name-id" class="text">{{cert.skapadAv.vardenhet.enhetsnamn}} ({{cert.skapadAv.vardenhet.enhetsid}})</span><br/>
	                <span class="title">Postadress</span> <span id="careunit-postal_address" class="text">{{cert.skapadAv.vardenhet.postadress}}, {{cert.skapadAv.vardenhet.postnummer}} {{cert.skapadAv.vardenhet.postort}}</span>
	              </div>

            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

</div>
